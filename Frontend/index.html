<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Wyatt Mogelson">
    <title>Login Page</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div style = "text-align: center;"> 
        <div class = "header">
            <h1 class = "header-text"> <img src = "/images/instagram_logo.svg" width="24.004" height="24" title="instagram_logo"> Instagram Unfollower Tool </h1>
        </div>
        <div class = "form-box">
            <div class = "button-box transition">
                <div id="switch-btn"></div>
                <button class = "toggle-btn" id = "to-login" onclick="toLogin()">Login</button>
                <button class =  "toggle-btn" id = "to-register" onclick="toRegister()">Register</button>
            </div>
        <form id = "login-screen" class="input-group transition">
            <input class = "input-field", type ="text" id = "login-username" placeholder="Enter Username" required>
            <br><br>
            <input class = "input-field" type ="text" id = "login-password" placeholder="Enter Password" required>
            <p class = "err-message" id = "login-message"><br></p>
            <input type="checkbox" class="check-box"><span>Keep me logged in</span>
            <button class = "submit-btn" id = "login">Login</button>
            <!-- <p>Haven't made an account?</p><a href="views/register.html">Register</a> -->
        </form>
        <form id = "register-screen" class="input-group transition">
            <input class = "input-field", type ="text" id = "register-username" placeholder="Enter New Username">
            <br><br>
            <input class = "input-field" type ="text" id = "register-password" placeholder="Enter New Password">
            <p class = "err-message" id = "register-message"><br></p>
            <input type="checkbox" class="check-box"><span>I agree to the terms & conditions</span>
            <button class = "submit-btn" id = "register">Register</button>
        </form>
        <script>
            const registerBtn = document.getElementById("register");
            const loginBtn = document.getElementById("login");
            const registerPassword = document.getElementById("register-password");
            const registerUsername = document.getElementById("register-username");
            const loginPassword = document.getElementById("login-password");
            const loginUsername = document.getElementById("login-username");
            const baseUrl = 'http://localhost:8383';
            loginBtn.addEventListener('click', login);
            registerBtn.addEventListener('click', register);

            function spawnHeart(event){
                const newHeart = document.createElement('div');
                newHeart.classList.add('heart')
                // const x = event.clientX; // X coordinate of the click
                // const y = event.clientY;
                // console.log(x,y)
                // newHeart.style.left = x + 'px';
                // newHeart.style.top = y + 'px';
                newHeart.style.left = Math.random() * window.innerWidth + 'px';
                newHeart.style.top = Math.random() * window.innerHeight + 'px';
                document.getElementById("heart-loc").appendChild(newHeart);

                setTimeout(() => {
                newHeart.classList.add('hidden');
                // Optional: remove from DOM after it is invisible
                setTimeout(() => newHeart.remove(), 500); 
                }, 3500);
            }

            // document.addEventListener('click', spawnHeart);
            function startSpawning() {

                // Spawn 3 divs every second
                intervalId = setInterval(() => {
                for (let i = 0; i < 1; i++) {
                    spawnHeart();
                }
                }, 400); // 1000 ms = 1 second
            }
            window.onload = function() {
                startSpawning();
            };
            var login_screen = document.getElementById("login-screen");
            var register_screen = document.getElementById("register-screen");
            var switchBtn = document.getElementById("switch-btn");
            function toRegister(){
                login_screen.style.left = "-400px";
                register_screen.style.left = "50px";
                switchBtn.style.left = "110px";
            };
            function toLogin(){
                login_screen.style.left = "50px";
                register_screen.style.left = "450px";
                switchBtn.style.left = "0px";
            };
            function transition(){
                console.log("WOWOWOWW")
                const heartElements = document.querySelectorAll('.heart');
                const bodyElements = document.querySelectorAll('.transition');
                heartElements.forEach(element => {
                    element.style.opacity = 0;
                });
                bodyElements.forEach(element => {
                    element.classList.add('fade');
                })

            }
            async function register(e) {
                e.preventDefault();
                if (!registerUsername.value || !registerPassword.value) {
                    document.getElementById("register-message").textContent = "User or Password cannot be blank";
                    return;
                };
                const formData = new FormData();
                formData.append("password", registerPassword.value);
                formData.append("username", registerUsername.value);
                const res = await fetch(baseUrl + '/register', {
                    method: 'POST',
                    body: formData
                
                });
                if (res.ok) {
                    // display registered
                    document.getElementById("register-message").textContent = "Succesful Registered";
                }
                else {
                    if (res.status === 400) {
                        document.getElementById("register-message").textContent = "Username already taken";

                    }
                    else {
                        // Display error during registeration, try again later
                        document.getElementById("register-message").textContent = "Error during registration, try again later";
                    };
                };
                // const result = await res.json(); // Or use .json() if the server responds with JSON
                // console.log(result);
            };
            async function login(e) {
                e.preventDefault();
                if (!loginUsername.value || !loginPassword.value) {
                    document.getElementById("login-message").textContent = "Incorrect username or password"
                    return;
                };
                const formData = new FormData();
                formData.append("password", loginPassword.value);
                formData.append("username", loginUsername.value);
                const res = await fetch(baseUrl + '/login', {
                    method: 'POST',
                    body: formData
                  
                });
                if (res.ok) {
                    transition();
                    clearInterval(intervalId);
                    setTimeout(() => {
                        window.location.href = 'views/main.html';
                    }, 200); // 1000 ms = 1 second
                }
                else {
                    if (res.status === 400) {
                        // Display username or password incorrect
                        document.getElementById("login-message").textContent = "Incorrect username or password"
                    }
                    else {
                        document.getElementById("login-message").textContent = "Error during login, try again later"
                        // Display error during login, try again later
                    };
                };
            };
        </script>
    </div>
    <div class = "heart-transition" id = "heart-loc">

    </div>
</body>
</html>